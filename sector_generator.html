<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hex Star Sector Generator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">

</head>
<body class="h-screen w-screen overflow-hidden flex flex-col md:flex-row antialiased">

    <!-- SIDEBAR: Controls & Info -->
    <aside id="leftSidebar" class="relative w-full md:w-96 bg-slate-900 border-r border-slate-700 flex flex-col h-full z-10 shadow-2xl">
        
        <!-- Header -->
        <div id="leftSidebarHeader" class="p-3 border-b border-slate-700/50 bg-slate-900">
            <h1 class="text-sm font-semibold text-slate-200 tracking-wide">HexSector <span class="text-[10px] text-slate-500 align-top">v1.2</span></h1>
        </div>

        <!-- Controls (Scrollable part of sidebar) -->
        <div id="leftSidebarContent" class="flex-1 overflow-y-auto p-3 space-y-4">
            
            <!-- Grid Config -->
            <details id="gridConfigSection" open class="sidebar-section">
                <summary><h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wide">Grid Configuration</h2></summary>
                <div class="mt-2 space-y-3">
                <div class="flex gap-2 mb-2 bg-slate-800 p-1 rounded">
                    <button id="modeSizePresetBtn" class="flex-1 py-1 text-xs rounded bg-sky-600 text-white shadow transition-all">Preset</button>
                    <button id="modeSizeCustomBtn" class="flex-1 py-1 text-xs rounded text-slate-400 hover:text-white transition-all">Custom</button>
                </div>

                <!-- Size Preset UI -->
                <div id="sizePresetContainer">
                    <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Sector Size <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Preset sector dimensions. Custom mode lets you set width and height manually (1-100 each).">?</span></label>
                    <select id="sizePreset" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none">
                    </select>
                </div>

                <!-- Custom Size UI -->
                <div id="sizeCustomContainer" class="hidden grid grid-cols-2 gap-4">
                    <div>
                        <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Width <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Number of hex columns in the sector grid (1-100).">?</span></label>
                        <input type="number" id="gridWidth" min="1" max="100" value="8" 
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Height <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Number of hex rows in the sector grid (1-100).">?</span></label>
                        <input type="number" id="gridHeight" min="1" max="100" value="10" 
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none transition-colors">
                    </div>
                </div>
                </div>
            </details>

            <!-- Density Config -->
            <details id="stellarDensitySection" open class="sidebar-section">
                <summary><h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wide">Stellar Density</h2></summary>
                <div class="mt-2 space-y-3">
                <div class="flex gap-2 mb-2 bg-slate-800 p-1 rounded">
                    <button id="modePresetBtn" class="flex-1 py-1 text-xs rounded bg-sky-600 text-white shadow transition-all">Preset</button>
                    <button id="modeManualBtn" class="flex-1 py-1 text-xs rounded text-slate-400 hover:text-white transition-all">Custom</button>
                </div>

                <!-- Preset UI -->
                <div id="densityPresetContainer">
                    <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Density Level <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Target share of hexes that contain star systems.">?</span></label>
                    <select id="densityPreset" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none">
                    </select>
                </div>

                <!-- Manual UI -->
                <div id="densityManualContainer" class="hidden grid grid-cols-2 gap-4">
                    <div>
                        <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Min Systems <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Lower bound when using custom density mode.">?</span></label>
                        <input type="number" id="manualMin" min="0" value="5" 
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Max Systems <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Upper bound when using custom density mode.">?</span></label>
                        <input type="number" id="manualMax" min="1" value="15" 
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none">
                    </div>
                </div>
                </div>
            </details>

            <!-- Seed & Data -->
            <details id="seedDataSection" open class="sidebar-section">
                <summary><h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wide">Seed & Data</h2></summary>
                <div class="mt-2 space-y-3">
                <div>
                    <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Generation Profile <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Cinematic favors dramatic worlds, Hard Sci-Fi favors realism, Standard favors active sectors and hooks.">?</span></label>
                    <select id="generationProfile" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none">
                    </select>
                </div>
                <div>
                    <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Star Distribution <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Standard spreads systems uniformly. Clusters favors nearby groupings while keeping some spread.">?</span></label>
                    <select id="starDistribution" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none">
                    </select>
                </div>
                <div>
                    <label class="flex items-center gap-1 text-xs text-slate-500 mb-1">Seed <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Same seed and settings reproduce the same sector layout.">?</span></label>
                    <div class="flex gap-2">
                        <input type="text" id="seedInput" placeholder="Auto" 
                            class="flex-1 bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none transition-colors">
                        <button id="randomizeSeedBtn" class="px-2 text-xs bg-slate-800 border border-slate-600 rounded text-slate-300 hover:text-white hover:border-sky-500 transition-colors">Randomize</button>
                    </div>
                </div>
                <label class="flex items-center gap-2 text-xs text-slate-400">
                    <input type="checkbox" id="autoSeedToggle" class="accent-sky-500 bg-slate-800 border-slate-600 rounded">
                    Auto-new seed on generate
                    <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="Generates a fresh random seed each time you click Generate Sector.">?</span>
                </label>
                <label class="flex items-center gap-2 text-xs text-slate-400">
                    <input type="checkbox" id="realisticPlanetWeightsToggle" class="accent-sky-500 bg-slate-800 border-slate-600 rounded" checked>
                    Realistic planet weighting by star class
                    <span class="inline-flex items-center justify-center w-3.5 h-3.5 rounded-full border border-slate-600 text-[10px] text-slate-400 cursor-help" title="When enabled, planet types are weighted by star class instead of uniform random.">?</span>
                </label>
                </div>
            </details>

            <!-- Save / Load / I/O -->
            <details id="ioControlsSection" open class="sidebar-section">
                <summary><h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wide">Save / Load / I-O</h2></summary>
                <div class="mt-2 space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <button id="saveSectorLocalBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">Save Local</button>
                        <button id="loadSectorLocalBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">Load Local</button>
                        <button id="exportSectorBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors" aria-expanded="false">Export Suite</button>
                        <button id="triggerImportBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">Import JSON</button>
                    </div>
                    <div id="exportSuitePanel" class="hidden rounded border border-slate-700 bg-slate-900/70 p-2 space-y-2">
                        <div class="grid grid-cols-2 gap-2">
                            <button id="exportJsonBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">JSON Save</button>
                            <button id="exportSvgBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">SVG Map</button>
                            <button id="exportPngBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">PNG Map</button>
                            <button id="exportBriefBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">GM Brief</button>
                        </div>
                        <p class="text-[10px] text-slate-500">Exports use the current map state, including pin/edit changes.</p>
                    </div>
                    <input type="file" id="importFileInput" accept="application/json,.json" class="hidden" />
                </div>
            </details>

            <button id="generateSectorBtn" class="w-full py-2 bg-sky-600 hover:bg-sky-500 text-white rounded shadow-lg shadow-sky-900/50 font-semibold transition-all active:scale-95">
                GENERATE SECTOR
            </button>
            <button id="rerollUnpinnedBtn" class="w-full py-2 bg-amber-700 hover:bg-amber-600 text-white rounded shadow-lg shadow-amber-900/40 font-semibold transition-all active:scale-95">
                REROLL UNPINNED
            </button>

        </div>
        <div id="editHistoryPanel" class="hidden absolute right-0 bottom-16 translate-x-full w-52 border border-slate-700 border-l-0 rounded-r-lg bg-slate-900 p-3 space-y-2 shadow-2xl z-20">
            <div class="flex items-center justify-between">
                <h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wide">Edit History</h3>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <button id="undoBtn" class="py-1.5 text-sm rounded bg-slate-800 border border-slate-700 hover:border-amber-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Undo (Ctrl/Cmd+Z)" aria-label="Undo">&#8630;</button>
                <button id="redoBtn" class="py-1.5 text-sm rounded bg-slate-800 border border-slate-700 hover:border-amber-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Redo (Ctrl/Cmd+Y or Ctrl/Cmd+Shift+Z)" aria-label="Redo">&#8631;</button>
            </div>
            <ul id="historyList" class="max-h-28 overflow-y-auto space-y-1 pr-1"></ul>
        </div>
        <button id="toggleLeftPanelBtn" aria-label="Toggle controls panel" class="absolute top-24 right-0 translate-x-full w-7 h-12 rounded-r bg-slate-900 border border-slate-700 border-l-0 text-slate-200 font-semibold hover:text-white hover:border-sky-500 transition-colors z-30">&laquo;</button>
    </aside>

    <!-- MAIN: Map Area -->
    <main class="flex-1 bg-slate-950 relative overflow-hidden flex flex-col order-2">
        <!-- Toolbar / Status -->
        <div class="absolute top-0 left-0 w-full p-2 z-10 flex justify-between pointer-events-none">
            <div class="pointer-events-none flex items-start gap-2">
                <div class="bg-slate-900/90 backdrop-blur border border-slate-700 px-3 py-1 rounded text-xs text-slate-400 shadow-xl flex flex-col">
                    <div><span id="statusTotalHexes">0 Hexes</span> &bull; <span id="statusTotalSystems" class="text-sky-400 font-bold">0 Systems</span></div>
                    <div id="statusMessage" class="text-[10px] text-slate-500 mt-0.5"></div>
                </div>
                <div class="pointer-events-auto px-2 py-1 rounded bg-slate-900/85 border border-slate-700 shadow-xl flex flex-col gap-0.5">
                    <div id="currentSectorLabel" class="text-[11px] text-slate-400">Current: NNNN</div>
                    <div id="knownSectorsLabel" class="text-[10px] text-slate-500">Loaded: 1</div>
                    <button id="chartGateCorridorsBtn" class="hidden mt-1 px-1.5 py-1 text-[10px] rounded border border-cyan-700 bg-cyan-900/25 text-cyan-200 hover:bg-cyan-800/35 hover:border-cyan-500 transition-colors">Chart Gate Corridors</button>
                </div>
            </div>
            <div class="relative px-2 pointer-events-auto flex items-center gap-2">
                <button id="sectorHomeBtn" class="w-8 h-8 inline-flex items-center justify-center rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-amber-500 transition-colors" aria-label="Go home sector" title="Go home sector">&#8962;</button>
                <button id="toggleExpandedSectorViewBtn" class="w-auto h-8 px-2 inline-flex items-center justify-center rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors text-[10px]" aria-label="Enable expanded sector view" title="Enable expanded sector view">Expanded View: Off</button>
                <div class="group relative">
                    <button id="controlsInfoBtn" class="w-8 h-8 inline-flex items-center justify-center rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors" aria-label="Show controls" title="Show controls">i</button>
                    <div class="hidden group-hover:block group-focus-within:block absolute right-0 top-9 w-72 bg-slate-900/95 border border-slate-700 rounded-lg shadow-2xl p-2 space-y-2">
                        <h2 class="text-xs font-semibold text-slate-400 uppercase tracking-wide">Controls</h2>
                        <p class="text-[11px] text-slate-500">Scroll to zoom • Drag to move</p>
                        <div class="border-t border-slate-700 pt-2">
                            <p class="text-[10px] text-slate-500">Route shortcuts: Shift+Left Click set start/end. Third Shift+Left or normal click clears.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Scrollable Canvas Wrapper -->
        <div id="mapContainer" class="flex-1 overflow-hidden p-0 flex items-center justify-center bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4wNSkiLz48L3N2Zz4=')]">
            <svg id="hexGrid" class="w-full h-full drop-shadow-2xl"></svg>
        </div>
        <div class="absolute inset-0 z-20 pointer-events-none">
            <div id="expandedSectorEdgeNavContainer" class="absolute inset-0 pointer-events-none"></div>
            <button id="sectorNorthBtn" class="pointer-events-auto absolute top-20 left-1/2 -translate-x-1/2 w-8 h-8 rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors inline-flex items-center justify-center" aria-label="Move north" title="Move north">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 14L12 8L18 14" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button id="sectorSouthBtn" class="pointer-events-auto absolute bottom-8 left-1/2 -translate-x-1/2 w-8 h-8 rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors inline-flex items-center justify-center" aria-label="Move south" title="Move south">
                <svg class="w-4 h-4 rotate-180" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 14L12 8L18 14" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button id="sectorWestBtn" class="pointer-events-auto absolute left-20 top-1/2 -translate-y-1/2 w-8 h-8 rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors inline-flex items-center justify-center" aria-label="Move west" title="Move west">
                <svg class="w-4 h-4 -rotate-90" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 14L12 8L18 14" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button id="sectorEastBtn" class="pointer-events-auto absolute right-20 top-1/2 -translate-y-1/2 w-8 h-8 rounded-md bg-slate-900/90 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors inline-flex items-center justify-center" aria-label="Move east" title="Move east">
                <svg class="w-4 h-4 rotate-90" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 14L12 8L18 14" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
        <div class="absolute bottom-3 right-3 z-20 w-[min(24rem,calc(100%-1.5rem))] pointer-events-auto">
            <div class="bg-slate-900/95 border border-slate-700 rounded-lg shadow-2xl p-2 space-y-2">
                <div id="searchPanelHeader" class="flex items-center justify-between cursor-text" role="button" tabindex="0" aria-label="Focus search input">
                    <h2 class="text-xs font-semibold text-slate-400 uppercase tracking-wide">Search &amp; Filter</h2>
                    <button id="searchToggleBtn" class="w-6 h-6 inline-flex items-center justify-center text-xs rounded bg-slate-800 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors" title="Expand search panel" aria-label="Expand search panel">+</button>
                </div>
                <div id="searchPanelContent" class="hidden space-y-2">
                    <input
                        type="text"
                        id="searchNameInput"
                        placeholder="Search names, hex IDs, tags, star classes..."
                        class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm focus:border-sky-500 focus:outline-none"
                    >
                    <div class="grid grid-cols-2 gap-2">
                        <select id="searchScopeSelect" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none">
                            <option value="all">Systems + POIs</option>
                            <option value="systems">Systems Only</option>
                            <option value="pois">POIs Only</option>
                        </select>
                        <select id="searchSortSelect" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none">
                            <option value="relevance">Sort: Relevance</option>
                            <option value="name">Sort: Name</option>
                            <option value="hex">Sort: Hex ID</option>
                            <option value="population">Sort: Population</option>
                            <option value="planets">Sort: Planet Count</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <select id="searchStarClassSelect" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none">
                            <option value="">Any Class</option>
                        </select>
                        <select id="searchTagSelect" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none">
                            <option value="">Any Tag</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <select id="searchPlanetTypeSelect" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none">
                            <option value="">Any Planet Type</option>
                        </select>
                        <select id="searchResultLimitSelect" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none">
                            <option value="25">Show Top 25</option>
                            <option value="50">Show Top 50</option>
                            <option value="100">Show Top 100</option>
                            <option value="0">Show All</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <input
                            type="number"
                            min="0"
                            step="0.1"
                            id="searchMinPopInput"
                            placeholder="Min Pop (B)"
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none"
                        >
                        <input
                            type="number"
                            min="0"
                            step="0.1"
                            id="searchMaxPopInput"
                            placeholder="Max Pop (B)"
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none"
                        >
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <input
                            type="number"
                            min="0"
                            step="1"
                            id="searchMinPlanetsInput"
                            placeholder="Min Planets"
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none"
                        >
                        <input
                            type="number"
                            min="0"
                            step="1"
                            id="searchMaxPlanetsInput"
                            placeholder="Max Planets"
                            class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs focus:border-sky-500 focus:outline-none"
                        >
                    </div>
                    <div class="grid grid-cols-2 gap-1">
                        <label class="flex items-center gap-1.5 text-[11px] text-slate-400">
                            <input type="checkbox" id="searchInhabitedOnlyToggle" class="accent-sky-500 bg-slate-800 border-slate-600 rounded">
                            Inhabited
                        </label>
                        <label class="flex items-center gap-1.5 text-[11px] text-slate-400">
                            <input type="checkbox" id="searchCoreOnlyToggle" class="accent-sky-500 bg-slate-800 border-slate-600 rounded">
                            Core only
                        </label>
                        <label class="flex items-center gap-1.5 text-[11px] text-slate-400">
                            <input type="checkbox" id="searchPinnedOnlyToggle" class="accent-sky-500 bg-slate-800 border-slate-600 rounded">
                            Pinned only
                        </label>
                        <label class="flex items-center gap-1.5 text-[11px] text-slate-400">
                            <input type="checkbox" id="searchMultiStarOnlyToggle" class="accent-sky-500 bg-slate-800 border-slate-600 rounded">
                            Multi-star
                        </label>
                    </div>
                    <div class="flex gap-2">
                        <button id="searchApplyBtn" class="flex-1 py-1.5 text-xs rounded bg-sky-700 hover:bg-sky-600 text-white transition-colors">Search</button>
                        <button id="searchClearBtn" class="flex-1 py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors">Clear</button>
                    </div>
                    <p id="searchResultsCount" class="text-[11px] text-slate-500">0 matches</p>
                    <ul id="searchResultsList" class="max-h-56 overflow-y-auto space-y-1 pr-1"></ul>
                </div>
            </div>
        </div>
    </main>

    <!-- INFO SIDEBAR -->
    <aside id="rightSidebar" class="relative w-full md:w-96 bg-slate-900 border-t md:border-t-0 md:border-l border-slate-700 flex flex-col h-full z-10 shadow-2xl order-3">
        <div id="rightSidebarHeader" class="p-3 border-b border-slate-700/50 bg-slate-900">
            <div class="flex items-center justify-between gap-2">
                <h2 class="text-sm font-semibold text-slate-200 tracking-wide">System Information</h2>
                <button id="editModeToggleBtn" class="px-2 py-1 text-[10px] rounded border border-slate-600 bg-slate-800 text-slate-200 font-semibold tracking-wide transition-colors">
                    EDIT MODE: OFF
                </button>
            </div>
        </div>
        <div id="rightSidebarContent" class="flex-1 overflow-y-auto p-4">
            <div id="infoPanel" class="opacity-50 pointer-events-none transition-opacity duration-300">
                <div class="flex justify-between items-baseline mb-4">
                    <div class="inline-flex items-center gap-2">
                        <h2 class="text-xl font-bold text-white" id="infoHexId">--</h2>
                        <span id="infoHexCoreBadge" class="hidden core-system-name-badge" title="Core System" aria-label="Core System">◆</span>
                    </div>
                    <span class="text-xs px-2 py-0.5 rounded-full bg-slate-800 text-slate-400 border border-slate-600" id="infoType">Empty Space</span>
                </div>
                
                <div id="infoTopActionBar" class="hidden grid grid-cols-3 gap-1.5 mb-2">
                    <button id="pinSelectedSystemBtn" class="w-8 h-8 inline-flex items-center justify-center text-sm rounded bg-slate-800 border border-slate-700 hover:border-amber-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Pin system" aria-label="Pin system">📌</button>
                    <button id="rerollSelectedSystemBtn" class="w-8 h-8 inline-flex items-center justify-center text-sm rounded bg-slate-800 border border-slate-700 hover:border-sky-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Reroll system" aria-label="Reroll system">🎲</button>
                    <button id="setCoreSystemBtn" class="w-8 h-8 inline-flex items-center justify-center text-sm rounded bg-slate-800 border border-slate-700 text-slate-200 hover:border-amber-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Set core system" aria-label="Set core system">★</button>
                </div>
                <p id="selectedSystemPinState" class="hidden text-[11px] text-slate-500 mb-3">Pinned: No</p>
                <p id="selectedSystemCoreState" class="hidden text-[11px] text-slate-500 mb-3">Core: --</p>

                <div id="systemDetails" class="hidden space-y-4">
                    <div id="editModeControls" class="hidden grid grid-cols-2 gap-2">
                        <button id="editDeleteBodyBtn" class="py-1.5 text-xs rounded bg-slate-800 border border-slate-700 hover:border-rose-500 transition-colors">Delete Object</button>
                        <button id="editDeleteSystemBtn" class="py-1.5 text-xs rounded bg-rose-900/35 border border-rose-700 text-rose-200 hover:bg-rose-800/40 hover:border-rose-500 transition-colors">Delete System</button>
                    </div>

                    <!-- Star Info -->
                    <details id="infoStarDetails" open class="relative bg-slate-900/30 rounded border border-slate-800 p-2">
                        <summary id="infoStarSummary" class="text-xs font-bold text-slate-500 uppercase cursor-pointer select-none flex items-center gap-2 pr-8">
                            <span id="infoStarSummaryLabel">Stars (0)</span>
                        </summary>
                        <button id="editAddStarInSectionBtn" class="hidden absolute top-1.5 right-2 w-5 h-5 inline-flex items-center justify-center rounded border border-slate-600 text-slate-300 hover:text-white hover:border-amber-500" title="Add star" aria-label="Add star">+</button>
                        <div class="mt-2 space-y-3">
                            <div class="bg-slate-800/50 p-3 rounded border border-slate-700">
                                <div class="flex items-center gap-3">
                                    <div id="infoStarVisual" class="w-10 h-10 rounded-full shadow-lg"></div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between gap-2">
                                            <h3 id="infoSystemName" class="font-bold text-sky-300 truncate">System Name</h3>
                                            <div class="inline-flex items-center gap-1">
                                                <button id="deletePrimaryStarBtn" class="hidden w-6 h-6 inline-flex items-center justify-center text-xs rounded bg-rose-900/35 border border-rose-700 text-rose-200 hover:bg-rose-800/40 hover:border-rose-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Delete primary star" aria-label="Delete primary star">🗑</button>
                                                <button id="renameSystemBtn" class="w-6 h-6 inline-flex items-center justify-center text-xs rounded bg-slate-800 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Rename system" aria-label="Rename system">✎</button>
                                            </div>
                                        </div>
                                        <div class="flex flex-wrap gap-3 text-xs mt-0.5">
                                            <p id="infoStarClass" class="text-slate-400">Class G2V</p>
                                            <p id="infoStarAge" class="text-slate-500">Age: --</p>
                                        </div>
                                        <div id="editStarClassRow" class="hidden mt-2">
                                            <label class="block text-[10px] text-slate-500 mb-1">Star Type</label>
                                            <select id="editStarClassSelect" class="w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-xs text-slate-200 focus:border-sky-500 focus:outline-none">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="infoStarList" class="hidden space-y-3"></div>
                        </div>
                    </details>

                    <!-- Stats -->
                    <div class="grid grid-cols-1 gap-3 text-xs">
                        <div class="bg-slate-800 p-3 rounded">
                            <span class="block text-slate-500">Population</span>
                            <span id="infoPop" class="text-lg font-mono text-white">0</span>
                        </div>
                    </div>

                    <!-- Bodies List -->
                    <div class="space-y-3 pr-1">
                        <details open class="bg-slate-900/30 rounded border border-slate-800 p-2">
                            <summary id="infoPlanetSummary" class="text-xs font-bold text-slate-500 uppercase cursor-pointer select-none flex items-center justify-between gap-2">
                                <span id="infoPlanetSummaryLabel">Planets (0)</span>
                                <button id="editAddPlanetInSectionBtn" class="hidden w-5 h-5 inline-flex items-center justify-center rounded border border-slate-600 text-slate-300 hover:text-white hover:border-emerald-500" title="Add planet" aria-label="Add planet">+</button>
                            </summary>
                            <ul id="infoPlanetList" class="space-y-2 text-sm text-slate-300 mt-2">
                                <!-- Populated by JS -->
                            </ul>
                        </details>
                        <details open class="bg-slate-900/30 rounded border border-slate-800 p-2">
                            <summary id="infoBeltSummary" class="text-xs font-bold text-slate-500 uppercase cursor-pointer select-none flex items-center justify-between gap-2">
                                <span id="infoBeltSummaryLabel">Belts &amp; Fields (0)</span>
                                <button id="editAddBeltInSectionBtn" class="hidden w-5 h-5 inline-flex items-center justify-center rounded border border-slate-600 text-slate-300 hover:text-white hover:border-violet-500" title="Add belt or field" aria-label="Add belt or field">+</button>
                            </summary>
                            <ul id="infoBeltList" class="space-y-2 text-sm text-slate-300 mt-2">
                                <!-- Populated by JS -->
                            </ul>
                        </details>
                        <details open class="bg-slate-900/30 rounded border border-slate-800 p-2">
                            <summary id="infoStationSummary" class="text-xs font-bold text-slate-500 uppercase cursor-pointer select-none flex items-center justify-between gap-2">
                                <span id="infoStationSummaryLabel">Stations (0)</span>
                                <button id="editAddStationInSectionBtn" class="hidden w-5 h-5 inline-flex items-center justify-center rounded border border-slate-600 text-slate-300 hover:text-white hover:border-fuchsia-500" title="Add station" aria-label="Add station">+</button>
                            </summary>
                            <ul id="infoStationList" class="space-y-2 text-sm text-slate-300 mt-2">
                                <!-- Populated by JS -->
                            </ul>
                        </details>
                    </div>

                </div>
                
                <div id="emptyDetails" class="text-sm text-slate-500 italic mt-4 text-center">
                    Select a hex to view data.
                </div>
                <button id="addSystemHereBtn" class="hidden mt-3 w-full py-1.5 text-xs rounded bg-emerald-900/35 border border-emerald-700 text-emerald-200 hover:bg-emerald-800/40 hover:border-emerald-500 transition-colors">
                    Add System Here
                </button>
                <button id="addPoiHereBtn" class="hidden mt-2 w-full py-1.5 text-xs rounded bg-emerald-900/35 border border-emerald-700 text-emerald-200 hover:bg-emerald-800/40 hover:border-emerald-500 transition-colors">
                    Add POI Here
                </button>
                <button id="deletePoiHereBtn" class="hidden mt-2 w-full py-1.5 text-xs rounded bg-rose-900/35 border border-rose-700 text-rose-200 hover:bg-rose-800/40 hover:border-rose-500 transition-colors">
                    Delete POI
                </button>
            </div>
        </div>
        <button id="toggleRightPanelBtn" aria-label="Toggle info panel" class="absolute top-24 left-0 -translate-x-full w-7 h-12 rounded-l bg-slate-900 border border-slate-700 border-r-0 text-slate-200 font-semibold hover:text-white hover:border-sky-500 transition-colors z-30">&raquo;</button>
    </aside>

    <div id="infoBodyDetailsPanel" class="hidden fixed z-50 w-64 bg-slate-900/95 border border-slate-700 rounded-lg shadow-xl p-3">
        <div class="text-xs font-bold text-slate-500 uppercase mb-2">Object Details</div>
        <div id="infoBodyDetailsEmpty" class="text-xs text-slate-500 italic">Select a planet, belt, or station to inspect.</div>
        <div id="infoBodyDetailsContent" class="hidden">
            <div class="flex justify-between items-baseline gap-3">
                <h4 class="text-sm font-semibold text-sky-200 inline-flex items-center gap-2">
                    <span id="infoBodyDetailsIcon" aria-hidden="true"></span>
                    <span id="infoBodyDetailsName">Body</span>
                </h4>
                <div class="text-right">
                    <span id="infoBodyDetailsType" class="block text-[11px] text-slate-400">Type</span>
                    <span id="infoBodyDetailsSize" class="hidden text-[11px] text-slate-500 cursor-help underline decoration-dotted decoration-slate-500/70 underline-offset-2" data-field-tooltip="size">--</span>
                </div>
            </div>
            <div class="mt-2 flex items-center gap-2">
                <button id="rerollBodyBtn" class="hidden w-6 h-6 inline-flex items-center justify-center text-xs rounded bg-slate-800 border border-slate-700 text-slate-300 hover:text-white hover:border-sky-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Reroll planet" aria-label="Reroll planet">🎲</button>
                <button id="quickDeleteBodyBtn" class="hidden w-6 h-6 inline-flex items-center justify-center text-xs rounded bg-rose-900/35 border border-rose-700 text-rose-200 hover:bg-rose-800/40 hover:border-rose-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Delete object" aria-label="Delete object">🗑</button>
            </div>
            <div id="editPlanetTypeRow" class="hidden mt-2">
                <label class="block text-[10px] text-slate-500 mb-1">Planet Type</label>
                <select id="editPlanetTypeSelect" class="w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-xs text-slate-200 focus:border-sky-500 focus:outline-none">
                </select>
            </div>
            <div id="editInhabitPlanetRow" class="hidden mt-2">
                <button id="editInhabitPlanetBtn" class="w-full py-1.5 text-xs rounded bg-emerald-900/35 border border-emerald-700 text-emerald-200 hover:bg-emerald-800/40 hover:border-emerald-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Inhabit Planet
                </button>
            </div>
            <div id="infoBodyEnvironmentRow" class="hidden mt-2 grid grid-cols-2 gap-2">
                <div class="rounded border border-slate-800 bg-slate-900/45 px-2 py-1">
                    <div class="text-[10px] text-slate-500 uppercase">Atmosphere</div>
                    <div id="infoBodyAtmosphere" class="text-xs text-slate-200 cursor-help underline decoration-dotted decoration-slate-500/70 underline-offset-2" data-field-tooltip="atmosphere">--</div>
                </div>
                <div class="rounded border border-slate-800 bg-slate-900/45 px-2 py-1">
                    <div class="text-[10px] text-slate-500 uppercase">Temperature</div>
                    <div id="infoBodyTemperature" class="text-xs text-slate-200 cursor-help underline decoration-dotted decoration-slate-500/70 underline-offset-2" data-field-tooltip="temperature">--</div>
                </div>
            </div>
            <div id="infoBodyPopulationRow" class="hidden mt-2 rounded border border-slate-800 bg-slate-900/45 px-2 py-1">
                <div class="text-[10px] text-slate-500 uppercase">Population</div>
                <div id="infoBodyPopulation" class="text-xs text-slate-200">--</div>
            </div>
            <div id="infoBodyTagsRow" class="hidden mt-2 rounded border border-slate-800 bg-slate-900/45 px-2 py-1">
                <div class="text-[10px] text-slate-500 uppercase">Tags</div>
                <div id="infoBodyTags" class="mt-1 flex flex-wrap gap-1"></div>
            </div>
            <p id="infoBodyDetailsPlaceholder" class="text-xs text-slate-400 mt-2"></p>
        </div>
    </div>
    <div id="starClassTooltip" class="hidden fixed z-50 w-64 bg-slate-900/95 border border-slate-700 text-[11px] text-slate-200 rounded-lg shadow-xl px-3 py-2 pointer-events-none"></div>
    <div id="fieldInfoTooltip" class="hidden fixed z-50 w-64 bg-slate-900/95 border border-slate-700 text-[11px] text-slate-200 rounded-lg shadow-xl px-3 py-2 pointer-events-none"></div>
    <script type="module" src="js/main.js"></script>

</body>
</html>
